name: Absolute Force Deploy

on:
  push:
    branches: [main]
    paths:
      - 'prem_service/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          path: 'source'  # –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–ø–∫—É

      - name: Nuclear Deploy
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: ${{ secrets.SERVER_PORT }}
          script: |
            echo "1. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã..."
            rm -rf ~/prem-service/prem_service/*
            
            echo "2. –ö–æ–ø–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã..."
            rsync -av $GITHUB_WORKSPACE/source/prem_service/ ~/prem-service/prem_service/
            
            echo "3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:"
            ls -la ~/prem-service/prem_service
            
            echo "4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å..."
            docker compose -f ~/prem-service/docker-compose.yml restart web
            echo "üî• –í—Å—ë –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–æ!"
